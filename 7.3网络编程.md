# 网络编程基础

计算机接入互联网，就必须使用TCP/IP协议，TCP/IP协议泛指互联网协议，其中最重要的两个协议是TCP协议和IP协议。其他网络协议不行。

## IP地址

标识网络接口，每个联入互联网的计算器至少有一个IP地址，两个网卡就可有两个IP地址

IPv4采用32位地址，类似`101.202.99.12`，而IPv6采用128位地址，类似`2001:0DA8:100A:0000:0000:1020:F2F3:1428`。IPv4已耗尽

公网IP可以直接访问，内网IP只能内网访问

内网：

- 192.168.x.x
- 10.x.x.x

本机地址：127.0.0.1



```ascii
106717964 = 0x65ca630c
          = 65  ca  63 0c
          = 101.202.99.12
```

冷知识：IPv4是32位整数



```
IP = 101.202.99.2
Mask = 255.255.255.0
Network = IP & Mask = 101.202.99.0
```

如果两台计算机计算出的网络号相同，说明两台计算机在同一个网络，可以直接通信。
网关的作用就是连接多个网络，负责把来自一个网络的数据包发到另一个网络，这个过程叫路由。交换机

- 网关的IP地址，例如：`10.0.2.2`

## 域名

```
shawn@hujunhaodeMacBook-Air ~ % nslookup www.baidu.com
Server:		192.168.3.1
Address:	192.168.3.1#53

Non-authoritative answer:
www.baidu.com	canonical name = www.a.shifen.com.
Name:	www.a.shifen.com
Address: 14.215.177.38
Name:	www.a.shifen.com
Address: 14.215.177.39
```

域名解析服务DNS负责把域名翻译成IP

## 网络模型

OSI 7层模型：

- 应用层，提供应用程序之间的通信；
- 表示层：处理数据格式，加解密等等；
- 会话层：负责建立和维护会话；
- 传输层：负责提供端到端的可靠传输；
- 网络层：负责根据目标地址选择路由来传输数据；
- 链路层和物理层负责把数据进行分片并且真正通过物理网络传输，例如，无线网、光纤等。

实际使用的不是这个模型，用的是TCP/IP模型，大致对应如下

| OSI    | TCP/IP     |
| :----- | :--------- |
| 应用层 | 应用层     |
| 表示层 | 应用层     |
| 会话层 | 应用层     |
| 传输层 | 传输层     |
| 网络层 | IP层       |
| 链路层 | 网络接口层 |
| 物理层 | 网络接口层 |

IP协议只负责发数据包，一种分组交换传输协议；TCP是面向连接的协议，支持可靠传输和双向通信。许多高级协议都是建立在TCP协议之上的，例如HTTP、SMTP等。TCP基于IP

UDP协议它是无连接协议，不保证可靠传输。因为UDP协议在通信前不需要建立连接，语音视频通信的应用会选择UDP协议。

# TCP编程

```ascii
┌───────────┐                                   ┌───────────┐
│Application│                                   │Application│
├───────────┤                                   ├───────────┤
│  Socket   │                                   │  Socket   │
├───────────┤                                   ├───────────┤
│    TCP    │                                   │    TCP    │
├───────────┤      ┌──────┐       ┌──────┐      ├───────────┤
│    IP     │<────>│Router│<─────>│Router│<────>│    IP     │
└───────────┘      └──────┘       └──────┘      └───────────┘
```

应用程序通过socket建立远程连接，socket内部通过TCP/IP把数据传输到网络。

只有IP地址辨别不到哪个程序，所以操作系统提供了socket接口，每个应用程序对应到不同的Socket，Socket就是由IP地址和端口号（范围是0～65535）组成

-  浏览器 101.202.99.2:1201
-  QQ 101.202.99.2:1304
-  邮件 101.202.99.2:15000

低于1024的端口是特权端口

客户端，它必须主动连接服务器的IP地址和指定端口

- 对服务器端来说，它的Socket是指定的IP地址和指定的端口号；
- 对客户端来说，它的Socket是它所在计算机的IP地址和一个由操作系统分配的随机端口号。

## 服务端

Java标准库提供了`ServerSocket`来实现对指定IP和指定端口的监听。

